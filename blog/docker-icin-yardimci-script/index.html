<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Docker iÃ§in yardÄ±mcÄ± script - GKMNGRGN</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="GeliÅŸtirme ortamÄ±nÄ± yÃ¶netmek iÃ§in yardÄ±mcÄ± bir script yazdÄ±m. KullanÄ±n, geliÅŸtirin, Ã¶nerilerinizi eksik etmeyin.">
    <meta property="og:site_name" content="GKMNGRGN" />
    <meta property="og:locale" content="nn_NO" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://gokmengorgen.net/blog/docker-icin-yardimci-script/" />
    <meta property="og:title" content="Docker iÃ§in yardÄ±mcÄ± script" />
    <meta property="og:image" content="https://gokmengorgen.net/img/laughing-man.png" />
    <meta property="og:description" content="GeliÅŸtirme ortamÄ±nÄ± yÃ¶netmek iÃ§in yardÄ±mcÄ± bir script yazdÄ±m. KullanÄ±n, geliÅŸtirin, Ã¶nerilerinizi eksik etmeyin." />

    
        <meta property="twitter:site" content="@gokmengorgen">
    

    <meta property="twitter:title" content="Docker iÃ§in yardÄ±mcÄ± script" />
    <meta property="twitter:image" content="https://gokmengorgen.net/img/laughing-man.png" />
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:description" content="GeliÅŸtirme ortamÄ±nÄ± yÃ¶netmek iÃ§in yardÄ±mcÄ± bir script yazdÄ±m. KullanÄ±n, geliÅŸtirin, Ã¶nerilerinizi eksik etmeyin." />

    
        <meta name="flattr:id" content="62knje">
    

    <link rel="canonical" href="https://gokmengorgen.net/blog/docker-icin-yardimci-script/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://gokmengorgen.net/css/main.css" />

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css" integrity="sha256-w6kCMnFvhY2tI1OnsYR/rb5DG9yFGodJknvFZOkp51E=" crossorigin="anonymous" />
    

    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/progressively/1.2.5/progressively.min.css" integrity="sha256-xbqLYBMsjpuCihs+3Fgp/MFMtPdo2SWKoOjEWOqR4X0=" crossorigin="anonymous" />
    

    <link rel="shortcut icon"
        href="https://gokmengorgen.net/img/laughing-man-favicon.png">

    

    <noscript>
        <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel="stylesheet">
    </noscript>
</head>

<body>
    
    <div class="my-4 my-md-5 header">
    <div class="container">
        <div class="row">
            <div class="col-auto offset-md-1 d-none d-md-block">
                
                    <a href="https://gokmengorgen.net/">
                        <img class="ml-md-4 logo" src="https://gokmengorgen.net/img/laughing-man.png" alt="logo">
                    </a>
                
            </div>
            <div class="col-auto align-self-center mr-auto">
                <a href="https://gokmengorgen.net/">
                    <h1 class="font-weight-bold name">GKMNGRGN</h1>
                </a>

                <ul class="nav nav-primary">
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-blog" href="https://gokmengorgen.net/blog/">
                                
                                YazÄ±lar
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-my-work" href="https://alageek.com">
                                
                                Ã‡alÄ±ÅŸmalarÄ±m
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase nav-link text-live" href="https://gokmengorgen.net/live/">
                                ğŸ“¹
                                CanlÄ± YayÄ±n
                            </a>
                        </li>
                    

                    
                </ul>

                <ul class="nav nav-secondary">
                    
                        <li class="nav-item">
                            <a class="text-uppercase font-weight-bold nav-link text-patreon" href="https://www.patreon.com/bePatron?u=10637849">
                                
                                Bana destek ol
                            </a>
                        </li>
                    
                        <li class="nav-item">
                            <a class="text-uppercase font-weight-bold nav-link text-bmc" href="https://www.buymeacoffee.com/gokmen">
                                
                                Kahve Ä±smarla
                            </a>
                        </li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>


    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-md-10">
                    <h1 class="mx-0 mx-md-4">Docker iÃ§in yardÄ±mcÄ± script</h1>

                    <div class="mb-4 mb-md-5 meta">
                        <span class="date" title='Sun Aug 5 2018 12:11:27 CEST'>
                            August 05, 2018
                        </span>

                        
                            
                        

                        <span class="reading-time middot">
                            3 minute read
                        </span>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                    <li class="d-inline middot">
                                        <a href="https://gokmengorgen.net/tags/coding">coding</a>
                                    </li>
                                
                                    <li class="d-inline middot">
                                        <a href="https://gokmengorgen.net/tags/devops">devops</a>
                                    </li>
                                
                            </ul>
                        </div>

                        <div class="d-none d-md-inline tags">
                            <ul class="list-unstyled d-inline">
                                
                                
                            </ul>
                        </div>
                    </div>

                    <div class="markdown">
                        
    
    

<p><em>Docker&rsquo;da projenin Ã§alÄ±ÅŸtÄ±rÄ±lacaÄŸÄ± ortam sayÄ±sÄ± arttÄ±kÃ§a, konteynerler Ã§oÄŸaldÄ±kÃ§a, yapÄ±landÄ±rma dosyalarÄ±nda satÄ±r sayÄ±sÄ± uzadÄ±kÃ§a komutlar da uzamaya, parametreler artmaya baÅŸlÄ±yor. Django shell&rsquo;e nasÄ±l baÄŸlanÄ±lÄ±yordu, Ã§eviri dosyalarÄ±nÄ± nasÄ±l gÃ¼ncelliyorduk, frontend sunucusu hazÄ±r mÄ± deÄŸil mi nasÄ±l anlÄ±yorduk demek yerine, sÄ±k kullanÄ±lan komutlarÄ± basit bir scriptle Ã§alÄ±ÅŸtÄ±rÄ±rsak beni rahatlatÄ±r diye dÃ¼ÅŸÃ¼ndÃ¼m ve internette bununla ilgili bir araÅŸtÄ±rma yaptÄ±m.</em></p>

<p>Ã–ncelikle bu tip iÅŸler iÃ§in <strong>Makefile</strong> kullanma Ã¶nerisi Ã§ok hoÅŸuma gitti. Epey basit ve anlaÅŸÄ±lÄ±r bir sÃ¶zdizimi var, komut satÄ±rÄ±nda Ã§ift tab yapÄ±p autocomplete yapabiliyorsunuz ve bu tip yardÄ±mcÄ± Ã¶zellikler epey verimliliÄŸi artÄ±rÄ±yor. Zaten amacÄ±mÄ±z verimliliÄŸi artÄ±rmak. Ama Windows kullananlarÄ±n Makefile&rsquo;i ayrÄ±ca yÃ¼klemesi gerekiyor.</p>

<p>Makefile&rsquo;i yÃ¼klemek (veya yÃ¼kletmek) bir problem deÄŸil; ama yine de alternatiflere bakma gereÄŸi duydum<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>. <strong>Docker compose</strong>&lsquo;da her bir komut iÃ§in ayrÄ± ayrÄ± servis oluÅŸturma fikri Ã§ok mantÄ±klÄ± gelmedi, bir de help Ã§Ä±ktÄ±sÄ± ile tÃ¼m komutlarÄ± aÃ§Ä±klamalarÄ±yla birlikte gÃ¶rmek istiyordum. O nedenle basit bir <strong>shell scripting</strong> ile zaten baÄŸÄ±mlÄ±lÄ±ÄŸÄ±mÄ±z olan eldeki araÃ§larÄ± kullanarak bu iÅŸi yapabileceÄŸimizi gÃ¶rdÃ¼m.</p>

<h2 id="kÄ±saca">KÄ±saca</h2>

<ul>
<li>Komutu parametresiz Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mda bana nasÄ±l kullanabileceÄŸimi gÃ¶sterecek.</li>
<li>Sistemin production mu, yoksa geliÅŸtirme ortamÄ± mÄ± olduÄŸunu ben belirleyeceÄŸim.</li>
<li>Komutu Ã§alÄ±ÅŸtÄ±rÄ±rken emin olmak iÃ§in ortamÄ± ve hatÄ±rlatmak iÃ§in asÄ±l komutu gÃ¶sterecek.</li>
</ul>

<pre><code class="language-bash">$ ./do.sh
 Available environments
   - DEV (default)
   - PROD
   - STAGING

 Available commands
   &gt; shell               Open Bash
   &gt; start               Create and start containers
   &gt; status              List containers
   &gt; stop                Stop services
</code></pre>

<p>Ã–ntanÄ±mlÄ± ortam, <strong>DEV</strong>:</p>

<pre><code class="language-bash">$ ./do.sh status
Environment: development
    Command: docker-compose -f docker-compose.yml -f docker-compose.dev.yml ps

Name                  State      Ports
----------------------------------------------------------------------------------------------
prj_amqp_1            Up         15671/tcp, 15672/tcp, 25672/tcp, 4369/tcp, 5671/tcp, 5672/tcp
prj_backend_1         Exit 137
prj_celery-beat_1     Up
prj_celery-worker_1   Up
prj_db_1              Up         5432/tcp
prj_es_1              Up         9200/tcp, 9300/tcp
prj_frontend_1        Up         0.0.0.0:8080-&gt;8080/tcp
</code></pre>

<p><strong>STAGING</strong> ortamÄ±nÄ± kullanmak istersek:</p>

<pre><code class="language-bash">$ ENV=STAGING ./do.sh shell
Environment: staging
    Command: docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d db frontend backend ...

...
</code></pre>

<p>Windows <strong>PowerShell</strong>&lsquo;de kullanmak iÃ§in:</p>

<pre><code class="language-powershell">&gt; $env:ENV = &quot;PROD&quot;;
&gt; bash do.sh status
Environment: production
    Command: docker-compose -f docker-compose.yml -f docker-compose.prod.yml ps
...
</code></pre>

<p>Windows&rsquo;ta <strong>Git Bash</strong> kullanÄ±yorsanÄ±z:</p>

<pre><code class="language-bash">$ ENV=STAGING winpty bash do.sh status
Environment: staging
    Command: docker-compose -f docker-compose.yml -f docker-compose.staging.yml ps
...
</code></pre>

<h2 id="Ã¶rnek-script">Ã–rnek script</h2>

<p>Yannick PEREIRA-REIS<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>&lsquo;e teÅŸekkÃ¼rler. <a href="http://azmesai.net/">Az Mesai</a> slack grubuna da geribildirim iÃ§in teÅŸekkÃ¼rler.</p>

<script src="https://gist.github.com/gkmngrgn/48303742353b0b17ae0e5c2d1d24ec3e.js"></script>

<!--
# BACKUP IS HERE #

#!/usr/bin/env bash

NORMAL="\\033[0;39m"
BLUE="\\033[1;34m"

print_help() {
    echo -e "$BLUE Available environments $NORMAL"
    echo "   - DEV (default)"
    echo "   - PROD"
    echo "   - STAGING"
    echo ""
    echo -e "$BLUE Available commands $NORMAL"
    echo -e "   > shell \t\t Open Bash"
    echo -e "   > start \t\t Create and start containers"
    echo -e "   > status \t\t List containers"
    echo -e "   > stop \t\t Stop services"
}

docker_command() {
    if [ "$ENV" = "PROD" ]
    then
        env_str="production"
        command="docker-compose -f docker-compose.yml -f docker-compose.prod.yml $@"
    elif [ "$ENV" = "STAGING" ]
    then
        env_str="staging"
        command="docker-compose -f docker-compose.yml -f docker-compose.staging.yml $@"
    else
        env_str="development"
        command="docker-compose -f docker-compose.yml -f docker-compose.dev.yml $@"
    fi

    echo -e "$BLUE \rEnvironment:$NORMAL $env_str"
    echo -e "$BLUE \r    Command:$NORMAL $command"
    echo -e ""
    eval $command
}

shell() {
    docker_command run --rm backend_shell bash
}

status() {
    docker_command ps
}

start() {
    docker_command up -d db amqp es frontend celery-beat celery-worker backend
}

stop() {
    docker_command stop
}

if [ -z "$1" ]
then
    print_help
else
    "$@"
fi
-->
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Yannick PEREIRA-REIS - <a href="https://ypereirareis.github.io/blog/2015/05/04/docker-with-shell-script-or-makefile/">Docker with shell script or Makefile</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>



                    </div>

                    
                        <div class="navigation">
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-left">
                                            <img class="icon" src="https://gokmengorgen.net/img/back.svg" alt="back" />
                                            <a href="https://gokmengorgen.net/blog/git-is-akisi/">Git iÅŸ akÄ±ÅŸÄ±</a>
                                        </div>
                                    
                                </div>
                                <div class="col-12 col-md-6">
                                    
                                        <div class="mx-0 mx-md-4 mt-4 text-right">
                                            <a href="https://gokmengorgen.net/blog/komutlar-icin-yardimci-script/">SÄ±k kullanÄ±lan komutlar iÃ§in yardÄ±mcÄ± script</a>
                                            <img class="icon" src="https://gokmengorgen.net/img/next.svg" alt="next" />
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                    
                </div>
            </div>
        </div>
    </div>

    <div class="my-4 footer">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-md-5">
                
                    <div class="mx-0 mx-md-4 text-left">
                        
                            <a href="https://gokmengorgen.net/lisans/">CC Â© 2018 GÃ¶kmen GÃ¶rgen.</a>
                        
                    </div>
                
            </div>
            <div class="col-sm-12 col-md-5">
                <div class="mx-0 mx-md-4 text-right">
                    

                    

                    

                    
                        <a href="https://github.com/gkmngrgn" target="_blank">
                            <img class="icon" src="https://gokmengorgen.net/img/github.svg" alt="github" />
                        </a>
                    

                    
                        <a href="https://twitter.com/gokmengorgen" target="_blank">
                            <img class="icon" src="https://gokmengorgen.net/img/twitter.svg" alt="twitter" />
                        </a>
                    

                    
                        <a href="https://www.linkedin.com/in/gokmengorgen" target="_blank">
                            <img class="icon" src="https://gokmengorgen.net/img/linkedin.svg" alt="linkedin" />
                        </a>
                    

                    
                        <a href="mailto:gokmen@alageek.com">
                            <img class="icon" src="https://gokmengorgen.net/img/email.svg" alt="email" />
                        </a>
                    

                    
                        <a href="https://gokmengorgen.net/index.xml" class="mr-0">
                            <img class="icon" src="https://gokmengorgen.net/img/rss.svg" alt="rss" />
                        </a>
                    

                    
                </div>
            </div>
        </div>
    </div>
</div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script>
    <script>
        WebFont.load({
            google: {
                families: ['Raleway:400,600,700', 'Merriweather:300,300i,700,700i']
            }
        });
    </script>

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cs.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/css.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/django.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/nginx.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/powershell.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/progressively/1.2.5/progressively.min.js" integrity="sha256-LvFVlLdfGI3WeEH+8Ni4kxLm02g2GlOfeGCGLXfRk/U=" crossorigin="anonymous"></script>
        <script>
            window.addEventListener('load', function() {
                progressively.init({delay: 30, throttle: 50});
            }, true);
        </script>
    

    

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-54304543-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
<script>
    (function (m, a, i, l, e, r) {
        m['MailerLiteObject'] = e; function f() {
            var c = { a: arguments, q: [] }; var r = this.push(c); return "number" != typeof r ? r : f.bind(c.q);
        }
        f.q = f.q || []; m[e] = m[e] || f.bind(f.q); m[e].q = m[e].q || f.q; r = a.createElement(i);
        var _ = a.getElementsByTagName(i)[0]; r.async = 1; r.src = l + '?v' + (~~(new Date().getTime() / 1000000));
        _.parentNode.insertBefore(r, _);
    })(window, document, 'script', 'https://static.mailerlite.com/js/universal.js', 'ml');

    var ml_account = ml('accounts', '1180610', 'p6p1h3r0l3', 'load');
</script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55bfede7196e342d"></script>

</body>

</html>
